<!DOCTYPE html>
<html>
  <head>
    <title>lesson18</title>
  </head>
  <body>

    <script>
      // 18a ------------------------------ //

      // const xhr = new XMLHttpRequest();

      // xhr.addEventListener('load', () => {
      //   console.log(xhr.response + ' 1')
      // })

      // xhr.open('GET', 'https://supersimplebackend.dev/greeting')
      // xhr.send()

      // // 18b ------------------------------ //

      // const promise = fetch('https://supersimplebackend.dev/greeting').then((response) => {
      //   return response.text()
      // }).then((message) => {
      //   console.log(message + ' 2')
      // })

      // // 18c ------------------------------ //

      // const promise2 = async () => {
      //   const response = await fetch('https://supersimplebackend.dev/greeting')
      //   const message = await response.text()
      //   console.log(message + ' 3')
      // }
      // promise2()

      // // 18d ------------------------------ //

      // const promise3 = async () => {
      //   try {
      //     const response = await fetch('https://supersimplebackend.dev/greeting', {
      //     method: 'POST',
      //     headers: {
      //       'Content-Type': 'application/json'
      //     },
      //     body: JSON.stringify(
      //       {
      //         name: "gabriel"
      //       }
      //     )
      //     })
      //     const name = await response.json()
      //     console.log(name)
      //     } catch (error) {
      //       console.log(`[ERROR] ${error}`)
      //     }
      // }
      // promise3()

      // // 18e ------------------------------ //

      // const promise4 = async () => {
      //   try {
      //     const response = await fetch('https://amazon.com')
      //     const result = await response.json()
      //     console.log(result)
      //   } catch (error) {
      //     console.log(`CORS error. Your request was blocked by the backend.`)
      //   }
      // }
      // promise4()

      // 18g ------------------------------ //

      const promise5 = async () => {
        try {
          const response = await fetch('https://supersimplebackend.dev/greeting', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            }
          })

          if (response.status >= 400) {
            throw response
          }
          
          const text = await response.text()
          console.log(text)

        } catch (error) {
            if (error.status === 400) {
              const errorMessage = await error.json()
              console.log(errorMessage)
            } else {
              console.log('Network error. Please try again later')
            }
          }
        }
        promise5()
    </script>
  </body>
</html>